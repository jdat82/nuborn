<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='HomePageHandler'>/**
</span> * @class HomePageHandler
 * The Page Handler of the home page
 * @extends nu.pages.PageHandler
 */
var HomePageHandler = PH.subClass({
	
<span id='HomePageHandler-method-constructor'>	/**
</span>	 * @constructor
	 * @override
	 * @inheritdoc
	 */
	init: function(){
		this._super({
			id: &quot;home&quot;,
			url: &quot;home.html&quot;
		});
	},

<span id='HomePageHandler-method-createHtmlElements'>	/**
</span>	 * @override
	 * @inheritdoc
	 */
	createHtmlElements: function()
	{
		var page = this.html.page;
		this.html.menuButton = page.find(&quot;div.menu-button&quot;);
		this.html.menu = page.find(&quot;#home-menu&quot;);
		this.html.carousel = $(&quot;#carousel&quot;);
		this.html.carouselWrapper = $(&quot;#carousel-wrapper&quot;);
		this.html.news = $(&quot;#news&quot;);
	},

<span id='HomePageHandler-method-createDataElements'>	/**
</span>	 * @override
	 * @inheritdoc
	 */
	createDataElements: function()
	{
		this.data = {}
		// Create the data to display in the carousel
		this.data.carousel = {
			cards: [
				{
					title: &quot;The Big Bang Theory&quot;,
					image: &quot;http://www.miglo.net/download/men-beard-the-big-bang-theory-1280x800.jpg&quot;
				},
				{
					title: &quot;Friends&quot;,
					image: &quot;http://2.bp.blogspot.com/-qsfnOy3X1o8/UIWNBoHZlSI/AAAAAAAAA6E/lpOoOTh0rJU/s1600/Friends_04.jpg&quot;
				},
				{
					title: &quot;How I Met Your Mother&quot;,
					image: &quot;http://popgoestheweek.com/wp-content/uploads/2012/12/how-i-met-your-mother-506192f593493.jpg&quot;
				},
				{
					title: &quot;One Piece&quot;,
					image: &quot;http://anime-vostfr.com/wp-content/uploads/2013/01/one-piece-581-vostfr.jpg?8b6f22&quot;
				}
			]
		};

		// Create the data to display in the menu
		this.data.menu = {
			items: [
				{
					title: &quot;Accueil&quot;,
					icon: &quot;home&quot;
				},
				{
					title: &quot;Profil&quot;,
					icon:&quot;profile&quot;
				},
				{
					title: &quot;Paramètres&quot;,
					icon: &quot;settings&quot;
				},
				{
					title: &quot;Aide&quot;,
					icon: &quot;help&quot;
				}
			]
		};

		// Create the data to display in the news
		this.data.news = {
			items: [
				{
					title: &quot;Le créateur des \&quot;Griffin\&quot; se pointe... dans \&quot;Les Simpson\&quot; !&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;dimanche 12 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/94/34/20558741.jpg&quot;
				},
				{
					title: &quot;La chaîne américaine ABC commande 12 nouvelles séries&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;samedi 11 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/97/28/20560689.jpg&quot;
				},
				{
					title: &quot;La série adaptée de \&quot;SHIELD\&quot; de Marvel est commandée&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;samedi 11 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/95/80/20559549.jpg&quot;
				},
				{
					title: &quot;\&quot;Nashville\&quot; est renouvelée&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;samedi 11 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/97/77/20560903.jpg&quot;
				},
				{
					title: &quot;Matthew Perry est maudit : \&quot;Go On\&quot; est annulée !&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;vendredi 10 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/97/54/20560816.jpg&quot;
				},
				{
					title: &quot;Ewan McGregor-Natalie Portman, de \&quot;Star wars\&quot; à \&quot;Jane got a gun\&quot;&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;mardi 7 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/88/93/20556957.jpg&quot;
				},
				{
					title: &quot;Le final de \&quot;Mentalist\&quot; !&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;lundi 6 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/86/24/20555126.jpg&quot;
				}

				// ************** //
				,
				{
					title: &quot;\&quot;Nashville\&quot; est renouvelée&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;samedi 11 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/97/77/20560903.jpg&quot;
				},
				{
					title: &quot;Matthew Perry est maudit : \&quot;Go On\&quot; est annulée !&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;vendredi 10 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/97/54/20560816.jpg&quot;
				},
				{
					title: &quot;Ewan McGregor-Natalie Portman, de \&quot;Star wars\&quot; à \&quot;Jane got a gun\&quot;&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;mardi 7 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/88/93/20556957.jpg&quot;
				},
				{
					title: &quot;Le final de \&quot;Mentalist\&quot; !&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;lundi 6 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/86/24/20555126.jpg&quot;
				},
				{
					title: &quot;\&quot;Nashville\&quot; est renouvelée&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;samedi 11 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/97/77/20560903.jpg&quot;
				},
				{
					title: &quot;Matthew Perry est maudit : \&quot;Go On\&quot; est annulée !&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;vendredi 10 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/97/54/20560816.jpg&quot;
				},
				{
					title: &quot;Ewan McGregor-Natalie Portman, de \&quot;Star wars\&quot; à \&quot;Jane got a gun\&quot;&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;mardi 7 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/88/93/20556957.jpg&quot;
				},
				{
					title: &quot;Le final de \&quot;Mentalist\&quot; !&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;lundi 6 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/86/24/20555126.jpg&quot;
				},
				{
					title: &quot;\&quot;Nashville\&quot; est renouvelée&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;samedi 11 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/97/77/20560903.jpg&quot;
				},
				{
					title: &quot;Matthew Perry est maudit : \&quot;Go On\&quot; est annulée !&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;vendredi 10 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/97/54/20560816.jpg&quot;
				},
				{
					title: &quot;Ewan McGregor-Natalie Portman, de \&quot;Star wars\&quot; à \&quot;Jane got a gun\&quot;&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;mardi 7 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/88/93/20556957.jpg&quot;
				},
				{
					title: &quot;Le final de \&quot;Mentalist\&quot; !&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;lundi 6 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/86/24/20555126.jpg&quot;
				},
				{
					title: &quot;\&quot;Nashville\&quot; est renouvelée&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;samedi 11 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/97/77/20560903.jpg&quot;
				},
				{
					title: &quot;Matthew Perry est maudit : \&quot;Go On\&quot; est annulée !&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;vendredi 10 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/97/54/20560816.jpg&quot;
				},
				{
					title: &quot;Ewan McGregor-Natalie Portman, de \&quot;Star wars\&quot; à \&quot;Jane got a gun\&quot;&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;mardi 7 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/88/93/20556957.jpg&quot;
				},
				{
					title: &quot;Le final de \&quot;Mentalist\&quot; !&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;lundi 6 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/86/24/20555126.jpg&quot;
				},
				{
					title: &quot;\&quot;Nashville\&quot; est renouvelée&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;samedi 11 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/97/77/20560903.jpg&quot;
				},
				{
					title: &quot;Matthew Perry est maudit : \&quot;Go On\&quot; est annulée !&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;vendredi 10 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/97/54/20560816.jpg&quot;
				},
				{
					title: &quot;Ewan McGregor-Natalie Portman, de \&quot;Star wars\&quot; à \&quot;Jane got a gun\&quot;&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;mardi 7 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/88/93/20556957.jpg&quot;
				},
				{
					title: &quot;Le final de \&quot;Mentalist\&quot; !&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;lundi 6 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/86/24/20555126.jpg&quot;
				},
				{
					title: &quot;\&quot;Nashville\&quot; est renouvelée&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;samedi 11 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/97/77/20560903.jpg&quot;
				},
				{
					title: &quot;Matthew Perry est maudit : \&quot;Go On\&quot; est annulée !&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;vendredi 10 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/97/54/20560816.jpg&quot;
				},
				{
					title: &quot;Ewan McGregor-Natalie Portman, de \&quot;Star wars\&quot; à \&quot;Jane got a gun\&quot;&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;mardi 7 mai&quot;,
					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/88/93/20556957.jpg&quot;
				},
				{
					title: &quot;Le final de \&quot;Mentalist\&quot; !&quot;,
					author: &quot;Jim Robs&quot;,
					date: &quot;lundi 6 mai&quot;,
<span id='HomePageHandler-method-pageBeforeShow'>					image: &quot;http://a69.g.akamai.net/n/69/10688/v1/img5.allocine.fr/acmedia/medias/nmedia/18/97/86/24/20555126.jpg&quot;
</span>				}
			]
		};
	},

	/**
	 * @override
	 * @inheritdoc
	 */
	pageBeforeShow: function(event, data){
		this.prepareMenu();
		this.handleMenuButton();
<span id='HomePageHandler-method-pageShow'>		this.prepareCarousel();
</span>		this.prepareNews();
	},

	/**
	 * @override
	 * @inheritdoc
	 */
	pageShow: function(event, data){
		// Initializing Carousel with the Swipe library
		this.html.carousel.Swipe();
		// if the splashscreen is handled from web
		if(app.splash){
			// hide splashscreen after 2 seconds
			setTimeout(function(){
				app.splash.hide(true);
			}, 2000);
		} 
		// if the splashscreen is handled natively with iOS
		else if(utils.isCordova() &amp;&amp; utils.isIOS()){
			// hide it immediately
<span id='HomePageHandler-method-pageHide'>			navigator.splashscreen.hide();
</span>		}
	},

	/**
	 * @override
	 * @inheritdoc
	 */
	pageHide: function(){
		// jQuery mobile does not remove the home page the first time
		if(Object.keys(this.html).length || Object.keys(this.data).length){
			log.i(&quot;Manually remove the Home Page.&quot;);
			this.deleteHtmlElements();
			this.deleteDataElements();
<span id='HomePageHandler-method-prepareMenu'>			$(&quot;#&quot;+this.settings.id).remove();
</span>		}
	},

	/**
	 * Prepare the data to be displayed in the menu panel. &lt;br/&gt;
	 * Also handle pressed states and taps of the menu items.
	 */
	prepareMenu: function(){
		// getting a local reference of the menu
		var menu = this.html.menu;
		// add template to carousel wrapper, rendered with previous data
		menu.append(Templates.home_menu_cell.render(this.data.menu));

		// handle pressed state on li
		menu.on(&quot;vmousedown&quot;, &quot;li&quot;, function(event){
			var self = $(this);
			self.addClass(&quot;pressed&quot;);
			self.one(&quot;vmouseup vmousemove&quot;, function(event){
				self.removeClass(&quot;pressed&quot;);
			});
		});
		// handle tap on li
		menu.on(&quot;tap&quot;, &quot;li&quot;, function(event){
			var self = $(this);
			self.removeClass(&quot;pressed&quot;);
			log.i(&quot;This feature has note been implented yet&quot;);
<span id='HomePageHandler-method-handleMenuButton'>			menu.panel(&quot;close&quot;);
</span>		});
	},

	/**
	 * Handle the menu button.
	 */
	handleMenuButton: function(){
		// getting a local reference of the menu button
		var menuButton = this.html.menuButton;
		// when touch start, go to active state
		menuButton.on(&quot;vmousedown&quot;, function(){
			// making the menu button active
			menuButton.addClass(&quot;pressed&quot;);
			// when touch end, go to normal state
			menuButton.one(&quot;vmouseup vmousemove&quot;, function(){
				// making the menu button normal
				menuButton.removeClass(&quot;pressed&quot;);
			});
		});
		
		// getting a local reference of the menu
		var menu = this.html.menu;
		// when tap on menu button, open menu panel
		menuButton.on(&quot;tap&quot;, function(){
			// opening menu panel
			menu.panel(&quot;open&quot;);
			// prevent bubbling
			return false;
		});
		// disabling scroll when the menu is open
		menu.on(&quot;panelbeforeopen&quot;, function(event, ui){
			utils.disableScroll();
		});
		// enabling scroll when the menu is closed
		menu.on(&quot;panelbeforeclose&quot;, function(event, ui){
<span id='HomePageHandler-method-prepareCarousel'>			utils.enableScroll();
</span>		});
	},

	/**
	 * Prepare the carousel. &lt;br/&gt;
	 * -- Load the data &lt;br/&gt;
	 * -- Render the data
	 */
	prepareCarousel: function(){
		// add template to carousel wrapper, rendered with carousel data
		this.html.carouselWrapper.html(Templates.home_card.render(this.data.carousel));
	},

	prepareNews: function(){
		// add template to news, rendered with news data
		var news = this.html.news;

		news.append(Templates.home_news_cell.render(this.data.news));

		news.on(&quot;vmousedown&quot;, &quot;li&quot;, function(){
			var self = $(this);

			self.addClass(&quot;pressed&quot;);
			self.one(&quot;vmouseup vmousemove&quot;, function(){
				self.removeClass(&quot;pressed&quot;);
			});
		});

		news.on(&quot;tap&quot;, &quot;li&quot;, function(){
			$.mobile.changePage(&quot;detail.html&quot;);
		});
	}
});

// create a shortcut to the home page handler
<span id='HomePageHandler-method-insertHTML'>app.home = new HomePageHandler();
</span>
/**
 * Load the page home.html and insert it to the body
 * @return {Deferred} The deferred of the process
 */
HomePageHandler.insertHTML = function(){
	// load the html of the home page and return the deferred's promise
	return $.ajax({
		// async: false,
		url: app.home.settings.url
	})
	// on success, prepend the data into the body
	.done(function(data){
		$(&quot;body&quot;).prepend(data);
	})
	// on error, log the error 
	.fail(function(){
		log.e(&quot;There was an error while inserting HTML of Home page.&quot;);
	})
	// return the promise
	.promise();
};</pre>
</body>
</html>
